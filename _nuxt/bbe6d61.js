(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{448:function(t,e,r){"use strict";var o=r(250);e.a=o.a},472:function(t,e,r){var content=r(476);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(23).default)("f43c1400",content,!1,{sourceMap:!1})},473:function(t,e,r){"use strict";r.r(e);var o=r(2),n=(r(3),r(73),r(10),r(7),r(8),r(16),r(9),r(17),r(121));function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var c={name:"MapPopup",props:["popupName","lat","lng","type","data"],data:function(){return{snackbar:!1,text:"Position copied in clipboard. It can be unprecised, so look around ;)",popupData:this.data,title:this.popupName,popupType:this.type}},computed:{geoposition:function(){return"quarry"===this.type||"well"===this.type?this.lat.toString().substring(0,8)+", "+this.lng.toString().substring(0,8):null}},methods:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({onCopy:function(t){console.log(t)},onCopyError:function(t){console.log(t)},snackTime:function(t){console.log("snacktime"),this.setSnack(this.text)}},Object(n.b)({setSnack:"snackbar/setSnack"}))},h=c,y=(r(475),r(72)),d=r(77),v=r.n(d),f=r(250),m=r(474),M=r(471),k=r(227),component=Object(y.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"popup-wrapper"},[r("v-card",{staticClass:"rounded-lg mx-2 transparent-card",attrs:{"max-width":"300px",flat:""}},[r("v-card-title",{staticClass:"pa-0 text-center h6"},[t._v("\n      "+t._s(t.title)+"\n    ")]),t._v(" "),"quarry"===t.popupType||"well"===t.popupType?r("v-card-text",{staticClass:"pa-0 text-center"},[r("v-btn",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.geoposition,expression:"geoposition",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.snackTime,expression:"snackTime",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.onCopyError,expression:"onCopyError",arg:"error"}],attrs:{icon:""}},[r("v-icon",{attrs:{dark:""}},[t._v("\n          mdi-content-copy\n        ")])],1),t._v("\n      "+t._s(t.geoposition)+"\n    ")],1):t._e(),t._v(" "),"urban"===t.popupType?r("v-card-text",{staticClass:"pb-1 text-center"},[t._v("\n      "+t._s(t.$t("cities.mapDetails"))+"\n    ")]):t._e(),t._v(" "),"property"===t.popupType?r("v-card-text",{staticClass:"pb-1"},[r("div",[t._v("Owner: "+t._s(t.popupData.ownerName))]),t._v(" "),r("div",[t._v("Price: "+t._s(t.popupData.price)+" E$ | Tiles: "+t._s(t.popupData.tileCount))]),t._v(" "),r("div",[t._v("Tier: "+t._s(t.popupData.landfieldTier)+" | Class: "+t._s(t.popupData.tileClass))]),t._v(" "),r("div",{staticClass:"text-center body-2"},[t._v("\n        "+t._s(t.$t("cities.openEarth2"))+"\n      ")])]):t._e(),t._v(" "),"quarry"===t.popupType||"well"===t.popupType?r("v-card-actions",{staticClass:"justify-center"},[r("v-btn",{attrs:{target:"_blank",rel:"noopener noreferrer",href:"https://www.openstreetmap.org/search?query="+t.lat+"%2C"+t.lng,small:"",color:"primary darken-1"}},[r("v-icon",{attrs:{dark:""}},[t._v("\n          mdi-open-in-new\n        ")]),t._v(" OpenStreetMap\n      ")],1)],1):t._e()],1)],1)}),[],!1,null,null,null);e.default=component.exports;v()(component,{VBtn:f.a,VCard:m.a,VCardActions:M.a,VCardText:M.b,VCardTitle:M.c,VIcon:k.a})},475:function(t,e,r){"use strict";r(472)},476:function(t,e,r){var o=r(22)(!1);o.push([t.i,'.mapboxgl-popup-close-button{display:none}.mapboxgl-popup-content{font:400 15px/22px "Source Sans Pro","Helvetica Neue",Sans-serif;background-color:hsla(0,0%,45.9%,.75);padding:0;border-radius:8px}.mapboxgl-popup-tip{border:15px solid transparent}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{border-top-color:hsla(0,0%,45.9%,.75)}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{border-right-color:hsla(0,0%,45.9%,.75)}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{border-left-color:hsla(0,0%,45.9%,.75)}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{border-bottom-color:hsla(0,0%,45.9%,.75)}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip,.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{border-top-color:hsla(0,0%,45.9%,.75)}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip,.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{border-bottom-color:hsla(0,0%,45.9%,.75)}.transparent-card{background-color:hsla(0,0%,45.9%,0)!important}',""]),t.exports=o},545:function(t,e,r){"use strict";r.r(e);r(10),r(16),r(17);var o=r(21),n=r(2),l=(r(83),r(63),r(7),r(47),r(24),r(3),r(9),r(73),r(8),r(479)),c=r.n(l),h=r(499),y=r(1),d=r(12),v=r(68),f=r(37),m=r(38),M=(r(20),r(49),r(477),r(322),r(321),r(78),r(31),r(44),r(251),r(34),r(504)),k=r(518),C=r.n(k),x=(r(28),function(){function t(e){if(Object(f.a)(this,t),this.PRECISION=6,this.cache={},this.D2R=Math.PI/180,this.R2D=180/Math.PI,this.A=6378137,this.MAXEXTENT=20037508.342789244,e=e||{},this.size=e.size||256,!this.cache[this.size]){var r=this.size,o=this.cache[this.size]={};o.Bc=[],o.Cc=[],o.zc=[],o.Ac=[];for(var n=0;n<30;n++)o.Bc.push(r/360),o.Cc.push(r/(2*Math.PI)),o.zc.push(r/2),o.Ac.push(r),r*=2}this.Bc=this.cache[this.size].Bc,this.Cc=this.cache[this.size].Cc,this.zc=this.cache[this.size].zc,this.Ac=this.cache[this.size].Ac}return Object(m.a)(t,[{key:"toRad",value:function(t){return t*Math.PI/180}},{key:"isFloat",value:function(t){return Number(t)===t&&t%1!=0}},{key:"px",value:function(t,e){if(this.isFloat(e)){var r=this.size*Math.pow(2,e),o=r/2,n=r/360,l=r/(2*Math.PI),c=r,h=Math.min(Math.max(Math.sin(this.D2R*t[1]),-.9999),.9999),y=o+t[0]*n,d=o+.5*Math.log((1+h)/(1-h))*-l;return y>c&&(y=c),d>c&&(d=c),[y,d]}var v=this.zc[e],f=Math.min(Math.max(Math.sin(this.D2R*t[1]),-.9999),.9999),m=Math.round(v+t[0]*this.Bc[e]),M=Math.round(v+.5*Math.log((1+f)/(1-f))*-this.Cc[e]);return m>this.Ac[e]&&(m=this.Ac[e]),M>this.Ac[e]&&(M=this.Ac[e]),[m,M]}},{key:"ll",value:function(t,e){if(this.isFloat(e)){var r=this.size*Math.pow(2,e),o=r/360,n=r/(2*Math.PI),l=r/2,c=(t[1]-l)/-n;return[(t[0]-l)/o,this.R2D*(2*Math.atan(Math.exp(c))-.5*Math.PI)]}var g=(t[1]-this.zc[e])/-this.Cc[e];return[(t[0]-this.zc[e])/this.Bc[e],this.R2D*(2*Math.atan(Math.exp(g))-.5*Math.PI)]}},{key:"bbox",value:function(t,e,r,o,n){o&&(e=Math.pow(2,r)-1-e);var l=[t*this.size,(+e+1)*this.size],c=[(+t+1)*this.size,e*this.size],h=this.ll(l,r).concat(this.ll(c,r));return"900913"===n?this.convert(h,"900913"):h}},{key:"xyz",value:function(t,e,r,o){"900913"===o&&(t=this.convert(t,"WGS84"));var n=[t[0],t[1]],l=[t[2],t[3]],c=this.px(n,e),h=this.px(l,e),y=[Math.floor(c[0]/this.size),Math.floor((h[0]-1)/this.size)],d=[Math.floor(h[1]/this.size),Math.floor((c[1]-1)/this.size)],v=Math.min.apply(Math,y),f=Math.min.apply(Math,d),m={maxX:Math.max.apply(Math,y),maxY:Math.max.apply(Math,d),minX:v<0?0:v,minY:f<0?0:f};if(r){var M={maxY:Math.pow(2,e)-1-m.minY,minY:Math.pow(2,e)-1-m.maxY};m.minY=M.minY,m.maxY=M.maxY}return m}},{key:"convert",value:function(t,e){return"900913"===e?this.forward(t.slice(0,2)).concat(this.forward(t.slice(2,4))):this.inverse(t.slice(0,2)).concat(this.inverse(t.slice(2,4)))}},{key:"forward",value:function(t){var e=[this.A*t[0]*this.D2R,this.A*Math.log(Math.tan(.25*Math.PI+.5*t[1]*this.D2R))];return e[0]>this.MAXEXTENT&&(e[0]=this.MAXEXTENT),e[0]<-this.MAXEXTENT&&(e[0]=-this.MAXEXTENT),e[1]>this.MAXEXTENT&&(e[1]=this.MAXEXTENT),e[1]<-this.MAXEXTENT&&(e[1]=-this.MAXEXTENT),e}},{key:"inverse",value:function(t){return[t[0]*this.R2D/this.A,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/this.A)))*this.R2D]}},{key:"bits",value:function(t){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;return Object(v.a)(Array(b)).map((function(e,r,o){return t>>o.length-r-1&1}))}},{key:"tileToQuadkeyCompress",value:function(t){for(var e=[],r=t[2];r>0;r--){var o=0,mask=1<<r-1;0!=(t[0]&mask)&&(o=1),0!=(t[1]&mask)&&(o+=2),e=e.concat(this.bits(o,2))}return 100*e.reduce((function(t,e,r){return t+e*Math.pow(2,r)}))+t[2]}},{key:"quadkeyCompressToTile",value:function(t){var e=0,r=0,o=t%100;(t=Math.trunc(t/100).toString(2).split("")).length<2*o&&(t=Array(2*o-t.length).fill("0").concat(t));for(var i=t.length-1;i>0;--i){var n=2*+t[i--]+ +t[i],mask=1<<Math.floor(i/2);1===n?e|=mask:2===n?r|=mask:3===n&&(e|=mask,r|=mask)}return[e,r,o]}},{key:"quadkeyToBbox",value:function(t){var e=this.quadkeyCompressToTile(t);return this.bbox(e[0],e[1],e[2])}},{key:"quadkeyToPolygon",value:function(t){var e=this.quadkeyToBbox(t),r=[[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]];return M.polygon(r)}},{key:"tileToLngLat",value:function(t,e,r){var o=this.tile2lon(t,r),n=this.tile2lat(e,r);return[+o.toFixed(this.PRECISION),+n.toFixed(this.PRECISION)]}},{key:"tile2lon",value:function(t,e){return t/Math.pow(2,e)*360-180}},{key:"tile2lat",value:function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return this.R2D*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}},{key:"getXYFromCoordinates",value:function(t,e){var r=t[0],o=t[1];return[parseInt(Math.floor((o+180)/360*Math.pow(2,e)),10),parseInt(Math.floor((1-Math.log(Math.tan(this.toRad(r))+1/Math.cos(this.toRad(r)))/Math.PI)/2*Math.pow(2,e)),10)]}},{key:"getTileIndexFromLatLng",value:function(t){var e=this.getXYFromCoordinates(t.reverse(),21);return P.tileToQuadkeyCompress([e[0],e[1],21])}}]),t}()),P=new x,T=P,w=180/Math.PI,_=function(t){return t*Math.PI/180},L=function(t){return t[Math.round(t.length/2)-(t.length%2==0?0:1)]},O=function(){function t(){Object(f.a)(this,t)}return Object(m.a)(t,[{key:"bits",value:function(t){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;return Object(v.a)(Array(b)).map((function(e,r,o){return t>>o.length-r-1&1}))}},{key:"tileToQuadkeyCompress",value:function(t){for(var e=[],r=t[2];r>0;r--){var o=0,mask=1<<r-1;0!=(t[0]&mask)&&(o=1),0!=(t[1]&mask)&&(o+=2),e=e.concat(this.bits(o,2))}return 100*e.reduce((function(t,e,r){return t+e*Math.pow(2,r)}))+t[2]}},{key:"quadkeyCompressToTile",value:function(t){var e=0,r=0,o=t%100;(t=Math.trunc(t/100).toString(2).split("")).length<2*o&&(t=Array(2*o-t.length).fill("0").concat(t));for(var i=t.length-1;i>0;--i){var n=2*+t[i--]+ +t[i],mask=1<<Math.floor(i/2);1===n?e|=mask:2===n?r|=mask:3===n&&(e|=mask,r|=mask)}return[e,r,o]}},{key:"projectWindow",value:function(t,e){var r=document.querySelector(e);return[[0,0],[0,1*r.width()],[1*r.height(),1*r.width()],[1*r.height(),0],[0,0]].map((function(t){return t.reverse()})).map((function(e){return t.unproject(e)})).map((function(t){return[t.lng,t.lat]}))}},{key:"bboxify",value:function(t,e){return[[t.x-e,t.y-e],[t.x+e,t.y+e]]}},{key:"tileToLngLat",value:function(t,e,r){var o=this.tile2lon(t,r),n=this.tile2lat(e,r);return[+o.toFixed(6),+n.toFixed(6)]}},{key:"tile2lon",value:function(t,e){return t/Math.pow(2,e)*360-180}},{key:"tile2lat",value:function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return w*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}},{key:"getXYFromCoordinates",value:function(t,e){var r=t[0],o=t[1];return[parseInt(Math.floor((o+180)/360*Math.pow(2,e)),10),parseInt(Math.floor((1-Math.log(Math.tan(_(r))+1/Math.cos(_(r)))/Math.PI)/2*Math.pow(2,e)),10)]}},{key:"quadkeyCompressToLngLat",value:function(t){var e=this.quadkeyCompressToTile(t);return this.tileToLngLat(e[0],e[1],e[2])}},{key:"quadkeyToBbox",value:function(t){var e=this.quadkeyCompressToTile(t);return T.bbox(e[0],e[1],e[2])}},{key:"quadkeysToPolygon",value:function(t){var e=this,r=C.a.union.apply(C.a,Object(v.a)(t.map((function(t){var r=e.quadkeyToBbox(t);return[[[r[0],r[1]],[r[0],r[3]],[r[2],r[3]],[r[2],r[1]]]]}))));return 0===r.length?null:1===r.length?M.polygon(r[0]):M.multiPolygon(r)}},{key:"lngLatArrayToString",value:function(t){return t.map((function(t){return"".concat(t).substring(0,9)})).join(", ")}},{key:"quadkeyCompressToLngLatString",value:function(t){return this.lngLatArrayToString(this.quadkeyCompressToLngLat(t).reverse())}},{key:"getCenterCoordinatesForCompressedQuadkeys",value:function(t){if(1===t.length)return this.quadkeyCompressToLngLat(t[0]);var e=[];for(var r in t)e.push(M.point(this.quadkeyCompressToLngLat(t[r])));if(e.length>0){var o=M.featureCollection(e),n=M.center(o).geometry.coordinates;return[+n[0].toFixed(6),+n[1].toFixed(6)]}return[0,0]}},{key:"getCenterCoordinatesForCompressedQuadkeysString",value:function(t){return this.lngLatArrayToString(this.getCenterCoordinatesForCompressedQuadkeys(t))}},{key:"isUUID",value:function(t){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(t)}},{key:"convertZoom",value:function(t,e){var r=this,o=this.quadkeyCompressToTile(t),n=e-o[2],l=Math.pow(2,n);o[0]=Math.floor(o[0]*l),o[1]=Math.floor(o[1]*l),o[2]=e;var c=[];if(n>0)for(var a=0;a<l;++a)for(var b=0;b<l;++b)c.push([o[0]+a,o[1]+b,e]);else c.push(o);return c.map((function(t){return r.tileToQuadkeyCompress(t)}))}},{key:"getTilesForBounds",value:function(t,e){for(var r=Object(d.a)(t,2),o=Object(d.a)(r[0],2),n=o[0],l=o[1],c=Object(d.a)(r[1],2),h=c[0],y=c[1],v=this.getXYFromCoordinates([l,n],e),f=Object(d.a)(v,2),m=f[0],M=f[1],k=this.getXYFromCoordinates([y,h],e),C=Object(d.a)(k,2),x=C[0],P=C[1],T=[],w=m;w<=x;++w)for(var _=P;_<=M;++_)T.push([w,_,e,this.tileToQuadkeyCompress([w,_,e])]);return T}},{key:"getTilesForBoundsMapped",value:function(t,e){for(var r=Object(d.a)(t,2),o=Object(d.a)(r[0],2),n=o[0],l=o[1],c=Object(d.a)(r[1],2),h=c[0],y=c[1],v=this.getXYFromCoordinates([l,n],e),f=Object(d.a)(v,2),m=f[0],M=f[1],k=this.getXYFromCoordinates([y,h],e),C=Object(d.a)(k,2),x=C[0],P=C[1],T=[],w=m;w<=x;++w)for(var _=P;_<=M;++_)T.push({tileId:this.tileToQuadkeyCompress([w,_,e]),x:w,y:_,z:e});return T}},{key:"getTileLengthForPoint",value:function(t){var e=M.bbox(M.buffer(M.point(t),10,{steps:1,units:"meters"}));return this.getTileLength(e)}},{key:"getTileLength",value:function(t){var e=this.getXYFromCoordinates([t[1],t[0]],21)[0],r=this.getXYFromCoordinates([t[3],t[2]],21)[1],o=T.bbox(e,r,21);return M.distance([o[0],o[1]],[o[0],o[3]],{units:"meters"})}},{key:"getRealCenter",value:function(t){var e=this;if(null==t||!t.length)return null;var r=t.map((function(t){return M.bboxPolygon(M.bbox(M.point(e.quadkeyCompressToLngLat(t))))})).map((function(t){return M.center(t).geometry.coordinates})),o=r.reduce((function(t,e){return t.x.includes(e[0])||t.x.push(e[0]),t.y.includes(e[1])||t.y.push(e[1]),t}),{x:[],y:[]}),n=o.x.length>=o.y.length?"x":"y",l=L(o[n].slice().sort((function(a,b){return a-b}))),c="x"===n?0:1,h="x"===n?1:0,y=r.filter((function(t){return t[c]===l}));return L(y.slice().sort((function(a,b){return a[h]-b[h]})))}},{key:"getBboxForPolygons",value:function(t){var e=C.a.union.apply(C.a,Object(v.a)(t.map((function(t){return t.geometry.coordinates}))));return M.bbox(M.multiPolygon(e))}},{key:"getArea",value:function(t){var e=C.a.union.apply(C.a,Object(v.a)(t.map((function(t){return t.geometry.coordinates}))));return M.area(M.multiPolygon(e))}}]),t}(),S=new O,j=r(473);function I(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function F(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?I(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):I(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var A={name:"CityDetails",components:{DiscordIcon:h.a},props:{city:{type:Object,default:null}},data:function(){return{accessToken:"pk.eyJ1Ijoid2FzcGlzY2hlIiwiYSI6ImNrazBidGRsNzBmdmIyeHJyYThjZG0wYzYifQ.qZQp-6ddFiyakTvvyCv8Gw",mapStyle:"mapbox://styles/mapbox/light-v10",loadTiles:!1,cityProperties:[],propertyLoaded:!1,forSaleToggle:!1,map:null,propertyPopup:null,popupContent:null,currentProperty:null,propertyLayer:{id:"property-layer",source:"properties",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["coalesce",["feature-state","tier"],["get","tier"]],1],"#fff",["get","color"]],"line-opacity":["case",["boolean",["coalesce",["feature-state","isSelected"],["get","isSelected"]],!1],1,.5],"line-width":2}},propertyFillLayer:{id:"property-fill-layer",source:"properties",type:"fill",paint:{"fill-color":["get","color"],"fill-opacity":.5}},propertyForSaleLayer:{id:"property-for-sale-layer",source:"properties",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["boolean",["coalesce",["feature-state","forSale"],["get","forSale"]],!1],"#ff0000","#e2e2e2"],"line-opacity":["case",["boolean",["coalesce",["feature-state","isSelected"],["get","isSelected"]],!1],1,.5],"line-width":2}},propertyForSaleFillLayer:{id:"property-for-sale-fill-layer",source:"properties",type:"fill",paint:{"fill-color":["case",["boolean",["coalesce",["feature-state","forSale"],["get","forSale"]],!1],"#ff0000","#e2e2e2"],"fill-opacity":.5}}}},computed:{showPropertiesButton:function(){return this.propertyLoaded?"city.refreshPropertiesButton":"city.showPropertiesButton"}},mounted:function(){c.a.accessToken=this.accessToken,this.map=new c.a.Map({container:"map",style:this.mapStyle,zoom:4,center:this.city.location.coordinates,sprite:"mapbox://sprites/mapbox/bright-v8"}),this.map.addControl(new c.a.FullscreenControl),this.map.on("load",this.onMapLoad),this.cityProperties=this.loadCachedProperties()},methods:{onMapLoad:function(t){(new c.a.Marker).setLngLat(this.city.location.coordinates).addTo(this.map),this.map.addSource("properties",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer(this.propertyLayer),this.map.addLayer(this.propertyFillLayer),this.map.addLayer(this.propertyForSaleLayer),this.map.addLayer(this.propertyForSaleFillLayer),this.map.setLayoutProperty("property-for-sale-layer","visibility","none"),this.map.setLayoutProperty("property-for-sale-fill-layer","visibility","none"),this.map.getCanvas().style.cursor="crosshair",this.map.on("mousemove","property-fill-layer",this.onMouseEnterProperty),this.map.on("mouseleave","property-fill-layer",this.onMouseLeaveProperty),this.map.on("click","property-fill-layer",this.onPropertyClick).on("click",this.onMapClick),this.propertyPopup=new c.a.Popup({closeButton:!1}),this.popupContent=new y.a(F(F({},j.default),{},{parent:this,propsData:{}})).$mount(),this.cityProperties.length>0&&(console.log("Add cached properties to map"),this.addPropertiesToMap(this.cityProperties),this.propertyLoaded=!0)},onMouseEnterProperty:function(t){this.map.getCanvas().style.cursor="pointer";var e=t.features[0];this.currentProperty=e.properties;var r=void 0===e.properties.description?"":e.properties.description;this.popupContent.title=r,this.popupContent.popupType="property",this.popupContent.popupData=e.properties,this.propertyPopup.setLngLat(t.lngLat).setDOMContent(this.popupContent.$el).addTo(this.map)},onMouseLeaveProperty:function(){this.map.getCanvas().style.cursor="crosshair";var t=document.getElementsByClassName("mapboxgl-popup");t[0]&&t[0].remove()},onPropertyClick:function(t){t.preventDefault(),t.originalEvent.preventDefault();var e=t.features[0],r=e.properties.propertyId;console.log(e),window.open("https://app.earth2.io/#thegrid/"+r)},showProperties:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loadTiles=!0,e.next=3,t.getCityProperties();case 3:t.cityProperties=e.sent,t.propertyLoaded=!0,t.cityProperties.length>0&&(t.addPropertiesToMap(t.cityProperties),t.setCachedProperties(t.cityProperties));case 6:case"end":return e.stop()}}),e)})))()},onMapClick:function(t){t.defaultPrevented||(console.log("Map clicked"),console.log(t.lngLat),window.open("https://app.earth2.io/?lng=".concat(t.lngLat.lng,"&lat=").concat(t.lngLat.lat)))},getCityProperties:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getCityProperties"),r=t.$route.params.id,e.prev=2,e.next=5,t.$axios.$get("/earth-2-properties/city/"+r);case 5:return o=e.sent,console.log(o),t.loadTiles=!1,e.abrupt("return",o);case 11:e.prev=11,e.t0=e.catch(2),t.error=!0,t.loadTiles=!1,console.log("error"),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,11]])})))()},addPropertiesToMap:function(t){var e=this,r=[];t.forEach((function(t){var polygon=e.processTiles(t);r.push(polygon)})),this.map.getSource("properties").setData({type:"FeatureCollection",features:r}),console.log(r),this.map.fitBounds(S.getBboxForPolygons(r))},togglePropertiesForSale:function(){this.forSaleToggle?(this.map.setLayoutProperty("property-layer","visibility","none"),this.map.setLayoutProperty("property-layer","visibility","none"),this.map.setLayoutProperty("property-for-sale-layer","visibility","visible"),this.map.setLayoutProperty("property-for-sale-fill-layer","visibility","visible")):(this.map.setLayoutProperty("property-layer","visibility","visible"),this.map.setLayoutProperty("property-layer","visibility","visible"),this.map.setLayoutProperty("property-for-sale-layer","visibility","none"),this.map.setLayoutProperty("property-for-sale-fill-layer","visibility","none"))},processTiles:function(t){if(!t.indices.length)return null;var polygon=S.quadkeysToPolygon(t.indices);return polygon.properties=F(F({},t),{},{color:this.stringToColor(t.ownerId),type:"landfield"}),polygon},stringToColor:function(t){for(var e=0,i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e);for(var r="#",o=0;o<3;o++){r+=("00"+(e>>8*o&255).toString(16)).substr(-2)}return r},loadCachedProperties:function(){var t=this,e=localStorage.getItem("properties");return console.log("loadCachedProperties"),console.log(JSON.parse(e).filter((function(e){return e.cityId===t.city.id}))),e?JSON.parse(e).filter((function(e){return e.cityId===t.city.id})):[]},setCachedProperties:function(t){var e=this;console.log("setCachedProperties");var r=localStorage.getItem("properties");r=r?JSON.parse(r).filter((function(t){return t.cityId===e.city.id})):[],console.log(r),r=0===r.length?t:r.filter((function(t){return t.cityId!==e.city.id})).concat(t),localStorage.setItem("properties",JSON.stringify(r))}}},E=r(72),D=r(77),z=r.n(D),X=r(525),N=r(250),B=r(474),R=r(465),Y=r(227),V=r(228),$=r(135),Q=r(96),J=r(118),G=r(467),H=r(626),component=Object(E.a)(A,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-card",{staticClass:"pa-4",attrs:{elevation:"4",rounded:""}},[r("v-row",[r("v-col",{attrs:{cols:"12",md:"8"}},[r("v-card",{staticStyle:{"min-height":"450px",height:"100%"},attrs:{id:"map"}})],1),t._v(" "),r("v-col",{staticClass:"text-body-1",attrs:{cols:"12",md:"4"}},[r("v-list",[r("v-list-item",[r("v-list-item-icon",[r("v-icon",{attrs:{color:"primary"}},[t._v("\n              mdi-map-marker\n            ")])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.city.location.coordinates))]),t._v(" "),r("v-list-item-subtitle",[t._v(t._s(t.$t("city.location")))])],1)],1),t._v(" "),r("v-list-item",{attrs:{href:t.city.url,target:"_blank",rel:"noopener noreferrer"}},[r("v-list-item-icon",[r("v-icon",{attrs:{color:"primary"}},[t._v("\n              mdi-open-in-new\n            ")])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v("\n              "+t._s(t.city.url)+"\n            ")]),t._v(" "),r("v-list-item-subtitle",[t._v(t._s(t.$t("city.e2Location")))])],1)],1),t._v(" "),t.city.website?r("v-list-item",{attrs:{href:t.city.website,target:"_blank",rel:"noopener noreferrer"}},[r("v-list-item-icon",[r("v-icon",{attrs:{color:"primary"}},[t._v("\n              mdi-web\n            ")])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v("\n              "+t._s(t.city.website)+"\n            ")]),t._v(" "),r("v-list-item-subtitle",[t._v(t._s(t.$t("cities.newCityModal.website")))])],1)],1):t._e(),t._v(" "),t.city.discord?r("v-list-item",{attrs:{href:t.city.discord,target:"_blank",rel:"noopener noreferrer"}},[r("v-list-item-icon",[r("discord-icon",{staticClass:"v-icon notranslate v-icon--dense mdi mdi-web theme--dark",attrs:{size:"1.2x",fill:"#21cff3"}})],1),t._v(" "),r("v-list-item-content",[t.city.discord?r("v-list-item-title",[t._v("\n              "+t._s(t.city.discord)+"\n            ")]):r("v-list-item-title",[t._v("\n              No discord\n            ")]),t._v(" "),r("v-list-item-subtitle",[t._v(t._s(t.$t("cities.newCityModal.discordServer")))])],1)],1):t._e(),t._v(" "),t.city.validated?r("v-list-item",[r("v-list-item-content",[r("v-btn",{staticClass:"mb-2",attrs:{color:"primary darken-1",dark:"",loading:t.loadTiles},on:{click:t.showProperties}},[t._v("\n              "+t._s(t.$t(t.showPropertiesButton))+"\n            ")]),t._v(" "),t.propertyLoaded&&0===t.cityProperties.length?r("v-alert",{attrs:{dense:"",type:"warning"}},[t._v("\n              "+t._s(t.$t("city.noProperty"))+"\n            ")]):t._e(),t._v(" "),t.propertyLoaded&&0!==t.cityProperties.length?r("v-switch",{attrs:{label:"Highlight properties for sale"},on:{change:t.togglePropertiesForSale},model:{value:t.forSaleToggle,callback:function(e){t.forSaleToggle=e},expression:"forSaleToggle"}}):t._e()],1)],1):t._e()],1)],1),t._v(" "),r("v-list",{staticClass:"pa-4"},[r("v-list-item-content",[r("v-list-item-title",{staticClass:"font-weight-medium"},[t._v("\n          "+t._s(t.$t("cities.newCityModal.description"))+"\n        ")]),t._v(" "),t.city.description?r("v-list-item-content",{staticClass:"text-justify"},[t._v("\n          "+t._s(t.city.description)+"\n        ")]):r("v-list-item-content",{staticClass:"text-justify"},[t._v("\n          "+t._s(t.$t("city.noDescription"))+"\n        ")])],1)],1)],1)],1)}),[],!1,null,"4272ed9d",null);e.default=component.exports;z()(component,{VAlert:X.a,VBtn:N.a,VCard:B.a,VCol:R.a,VIcon:Y.a,VList:V.a,VListItem:$.a,VListItemContent:Q.a,VListItemIcon:J.a,VListItemSubtitle:Q.b,VListItemTitle:Q.c,VRow:G.a,VSwitch:H.a})}}]);